function executeElementStatus(e,t){t?$(e).fadeIn(250):$(e).fadeOut(250)}function executeResponses(e){var t=$("#action-select");if(t.length){var n=t[0].selectize;for(var a in n.options){var o=n.options[a];"responses"==o.optgroup&&n.removeOption(a)}if(n.removeOptionGroup("responses"),Object.keys(e).length>0){n.addOptionGroup("responses",{id:"action-responses",label:"Responses"});for(var s in e)n.addOption({value:"r-"+s,icon:"comment",text:e[s],optgroup:"responses"})}}}function executeLocaleAct(){$.ajax("/q/localeact").done(function(e){console.log(e);var t=$("#action-select");if(t.length){var n=t[0].selectize;n.clearOptionGroups(),n.clearOptions(),console.log(e.actions);var a=[];for(var o in e.actions){var s=e.actions[o];console.log(s),s.optgroup in a||(n.addOptionGroup(s.optgroup,{id:"action-"+s.optgroup,label:s.optlabel}),a.push(s.optgroup)),n.addOption({value:s.value,icon:s.icon,text:s.text,optgroup:s.optgroup})}"responses"in e&&executeResponses(e.responses)}})}function executeLocaleTravel(){$.ajax("/q/localetravel").done(function(e){console.log(e);var t=$("#travel-select");if(t.length){var n=t[0].selectize;n.clearOptions(),console.log(e.linked);var a=!1;for(var o in e.linked){var s=e.linked[o];console.log(s),n.addOption({value:s.value,text:s.name}),a||(a=!0,n.setValue(s.value,!0))}}})}function executeActStatus(e){var t=$("#action-select");if(t.length){var n=t[0].selectize;e?n.unlock():n.lock()}}function executeMsg(e,t,n){if($("#central.messages").length){var a='<div class="message '+n+'">';e&&(a+='<span class="sender">'+e+":</span> "),a+=t+"</div>",$("#central.messages").append(a).animate({scrollTop:$("#central.messages").prop("scrollHeight")},"fast")}}function executeCommands(e,t){if(e.length>t){var n=e[t];console.log(n),"central"==n.type||("status"==n.type?executeElementStatus(n.element,n.status):"responses"==n.type?executeResponses(n.responses):"msg"==n.type?"eclass"in n?executeMsg(n.sender,n.msg,n.eclass):executeMsg(n.sender,n.msg,""):"localeact"==n.type?executeLocaleAct():"localetravel"==n.type?executeLocaleTravel():"location"==n.type?$("#travelModalRevealer").find("span").text(n.name):"actbarstatus"==n.type&&executeActStatus(n.status)),"time"in n&&n.time>0?(console.log(n.time),setTimeout(function(){executeCommands(e,t+1)},n.time)):(console.log(0),executeCommands(e,t+1))}}function setupPage(){var e=$("#action-select");e.length&&e.selectize({render:{option:function(e,t){return'<div class="option"><span class="icon"><i class="fa fa-'+t(e.icon)+'" /> </span><span class="title">'+t(e.text)+"</span></div>"}},onChange:function(e){e&&$.ajax("/q/act",{type:"POST",data:{value:e}}).done(function(e){executeCommands(e.commands,0)})}}),$(".player-unequip").click(function(){$.ajax("/q/punequip",{type:"POST",data:{skill:$(this).attr("id")}}).done(function(){Tipped.init(),$("#character").trigger("click")})}),$(".player-equip").click(function(){$.ajax("/q/pequip",{type:"POST",data:{skill:$(this).attr("id")}}).done(function(){Tipped.init(),$("#character").trigger("click")})}),Tipped.create(".inventory-item-filled",function(e){return{title:$(e).find(".tipped-title").html(),content:$(e).find(".tipped-content").html()}},{skin:"light"}),Tipped.create(".skill-filled",function(e){return{title:$(e).find(".tipped-title").html(),content:$(e).find(".tipped-content").html()}},{skin:"light"})}jQuery(document).ready(function(){setInterval("updateClock()",1e3),setupPage(),$("#central.messages").scrollTop($("#central.messages").prop("scrollHeight")),$("#menu").find("a").click(function(){var e=$(this).attr("id");$.ajax("/q/menu",{type:"GET",data:{menu:e}}).done(function(t){$("#content").fadeOut(400,function(){$("#menu").find("a.active").each(function(){$(this).removeClass("active")}),$("#"+e).addClass("active"),$("#content").html(t).fadeIn(400,function(){$("#central.messages").scrollTop($("#central.messages").prop("scrollHeight"))}),setupPage(),executeLocaleAct()})})}),$("#travelModalRevealer").click(function(){$("#travelModal").foundation("reveal","open")});var e=$("#travel-select").selectize();$(".shoeprints").find("a").click(function(){$.ajax("/q/travel",{type:"GET",data:{key:e[0].selectize.getValue()}}).done(function(e){$("#travelModal").foundation("reveal","close"),e&&executeCommands(e.commands,0)})}),$.ajax("/q/start").done(function(e){e&&executeCommands(e.commands,0)})});