function executeElementStatus(e,t){t?$(e).fadeIn(250):$(e).fadeOut(250)}function executeResponses(e){var t=$("#action-select");if(t.length){var s=t[0].selectize;for(var o in s.options){var n=s.options[o];"responses"==n.optgroup&&s.removeOption(o)}if(s.removeOptionGroup("responses"),Object.keys(e).length>0){s.addOptionGroup("responses",{id:"action-responses",label:"Responses"});for(var a in e)s.addOption({value:"r-"+a,icon:"comment",text:e[a],optgroup:"responses"})}}}function executeLocaleAct(){$.ajax("/q/localeact").done(function(e){console.log(e);var t=$("#action-select");if(t.length){var s=t[0].selectize;s.clearOptionGroups(),s.clearOptions(),console.log(e.actions);var o=[];for(var n in e.actions){var a=e.actions[n];console.log(a),a.optgroup in o||(s.addOptionGroup(a.optgroup,{id:"action-"+a.optgroup,label:a.optlabel}),o.push(a.optgroup)),s.addOption({value:a.value,icon:a.icon,text:a.text,optgroup:a.optgroup})}"responses"in e&&executeResponses(e.responses)}})}function executeMsg(e,t,s){if($("#central.messages").length){var o='<div class="message '+s+'">';e&&(o+='<span class="sender">'+e+":</span> "),o+=t+"</div>",$("#central.messages").append(o).animate({scrollTop:$("#central.messages").prop("scrollHeight")},"fast")}}function executeCommands(e,t){if(e.length>t){var s=e[t];console.log(s),"central"==s.type||("status"==s.type?executeElementStatus(s.element,s.status):"responses"==s.type?executeResponses(s.responses):"msg"==s.type?"eclass"in s?executeMsg(s.sender,s.msg,s.eclass):executeMsg(s.sender,s.msg,""):"localeact"==s.type&&executeLocaleAct()),"time"in s&&s.time>0?(console.log(s.time),setTimeout(function(){executeCommands(e,t+1)},s.time)):(console.log(0),executeCommands(e,t+1))}}function setupPage(){var e=$("#action-select");e.length&&e.selectize({render:{option:function(e,t){return'<div class="option"><span class="icon"><i class="fa fa-'+t(e.icon)+'" /> </span><span class="title">'+t(e.text)+"</span></div>"}},onChange:function(e){e&&$.ajax("/q/act",{type:"POST",data:{value:e}}).done(function(e){executeCommands(e.commands,0)})}})}jQuery(document).ready(function(){setInterval("updateClock()",1e3),setupPage(),$.ajax("/q/start").done(function(e){executeCommands(e.commands,0)})});