function executeElementStatus(e,t){t?$(e).fadeIn(250):$(e).fadeOut(250)}function executeResponses(e){var t=$("#action-select");if(t.length){var n=t[0].selectize;for(var s in n.options){var o=n.options[s];"responses"==o.optgroup&&n.removeOption(s)}if(n.removeOptionGroup("responses"),Object.keys(e).length>0){n.addOptionGroup("responses",{id:"action-responses",label:"Responses"});for(var a in e)n.addOption({value:"r-"+a,icon:"comment",text:e[a],optgroup:"responses"})}}}function executeLocaleAct(){$.ajax("/q/localeact").done(function(e){console.log(e);var t=$("#action-select");if(t.length){var n=t[0].selectize;n.clearOptionGroups(),n.clearOptions(),console.log(e.actions);var s=[];for(var o in e.actions){var a=e.actions[o];console.log(a),a.optgroup in s||(n.addOptionGroup(a.optgroup,{id:"action-"+a.optgroup,label:a.optlabel}),s.push(a.optgroup)),n.addOption({value:a.value,icon:a.icon,text:a.text,optgroup:a.optgroup})}"responses"in e&&executeResponses(e.responses)}})}function executeActStatus(e){var t=$("#action-select");if(t.length){var n=t[0].selectize;e?n.unlock():n.lock()}}function executeMsg(e,t,n){if($("#central.messages").length){var s='<div class="message '+n+'">';e&&(s+='<span class="sender">'+e+":</span> "),s+=t+"</div>",$("#central.messages").append(s).animate({scrollTop:$("#central.messages").prop("scrollHeight")},"fast")}}function executeCommands(e,t){if(e.length>t){var n=e[t];console.log(n),"central"==n.type||("status"==n.type?executeElementStatus(n.element,n.status):"responses"==n.type?executeResponses(n.responses):"msg"==n.type?"eclass"in n?executeMsg(n.sender,n.msg,n.eclass):executeMsg(n.sender,n.msg,""):"localeact"==n.type?executeLocaleAct():"actbarstatus"==n.type&&executeActStatus(n.status)),"time"in n&&n.time>0?(console.log(n.time),setTimeout(function(){executeCommands(e,t+1)},n.time)):(console.log(0),executeCommands(e,t+1))}}function setupPage(){var e=$("#action-select");e.length&&e.selectize({render:{option:function(e,t){return'<div class="option"><span class="icon"><i class="fa fa-'+t(e.icon)+'" /> </span><span class="title">'+t(e.text)+"</span></div>"}},onChange:function(e){e&&$.ajax("/q/act",{type:"POST",data:{value:e}}).done(function(e){executeCommands(e.commands,0)})}}),Tipped.create(".inventory-item-filled",function(e){return{title:$(e).find(".tipped-title").html(),content:$(e).find(".tipped-content").html()}},{skin:"light"})}jQuery(document).ready(function(){setInterval("updateClock()",1e3),setupPage(),$("#central.messages").scrollTop($("#central.messages").prop("scrollHeight")),$("#menu").find("a").click(function(){var e=$(this).attr("id");$.ajax("/q/menu",{type:"GET",data:{menu:e}}).done(function(t){$("#content").fadeOut(400,function(){$("#menu").find("a.active").each(function(){$(this).removeClass("active")}),$("#"+e).addClass("active"),$("#content").html(t).fadeIn(400,function(){$("#central.messages").scrollTop($("#central.messages").prop("scrollHeight"))}),setupPage(),executeLocaleAct()})})}),$("#travelModalRevealer").click(function(){$("#travelModal").foundation("reveal","open")}),$.ajax("/q/start").done(function(e){e&&executeCommands(e.commands,0)})});